<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Caro Ver 1.0</title>
    <link rel="stylesheet" type="text/css" href="myStyle.css">
</head>
<body>
<div class="center1">
    <h1>CARO CHESS GAME</h1>
    <label>Row number</label>
    <input id="rTxt" type="text" style="width: 30px" value="3">
    <label>Col number</label>
    <input id="cTxt" type="text" style="width: 30px" value="3">
    <label>Win number</label>
    <input id="wTxt" type="text" style="width: 30px" value="3">
    <button id="crtBtn" onclick="crtBoard()">Create Board</button>
    <br><br>
    <label>Select first mark</label>
    <label><input name="sltPlayer" value="X" type="radio" checked>X</label>
    <label><input name="sltPlayer" value="O" type="radio">O</label><br><br>
    <button onclick="rsGame()">Reset Game</button>
    <br><br>
    <label id="msg"></label><br><br>
    <div id="brd">
        <table id="tbl" class="center2"></table>
    </div>

</div>

</body>
<script>

    let rowNum; // Number of board game row
    let colNum; // Number of board game column
    let winNum; // Number of continued mark to win
    let countX = 0; // Count number of 'X' cells
    let countO = 0; // Count number of 'O' cells
    let countTotal = 0; // Count number of both 'X' and 'O' cells
    let board = []; // 2D array to store 'X' and 'O'

    // Create game board
    function crtBoard() {
        rowNum = parseInt(document.getElementById('rTxt').value);
        colNum = parseInt(document.getElementById('cTxt').value);
        winNum = parseInt(document.getElementById('wTxt').value);

        let brd = document.getElementById('brd');
        let tbl = document.getElementById('tbl');
        tbl.innerHTML = "";

        for (let i = 0; i < rowNum; i++) {
            let tr = tbl.insertRow();
            for (let j = 0; j < colNum; j++) {
                let td = tr.insertCell();
                td.style.border = '2px solid black';
                td.style.width = '50px';
                td.style.height = '50px';
                td.style.textAlign = 'center';
                td.style.fontSize = '30';
                td.id = 'c' + i + j;
                //td.setAttribute("onclick", function() { alert(td.id) });
                td.onclick = function () {
                    playGame(td.id)
                }
            }
        }

        board = Array(rowNum).fill().map(entry => Array(colNum))
        brd.appendChild(tbl);
    }

    //Reset game
    function rsGame() {
        for (let i = 0; i < rowNum; i++) {
            for (let j = 0; j < colNum; j++) {
                let cID = "c" + i + j;
                document.getElementById(cID).innerHTML = "";
                document.getElementById(cID).style.backgroundColor = 'white';
                board[i][j] = "";
            }
        }
        document.getElementById('msg').innerHTML = "";
        countX = 0;
        countO = 0;
        countTotal = 0;
    }

    // Click one board cell to play
    function playGame(cID) {
        let sltPlayer = document.getElementsByName('sltPlayer');
        let r = parseInt(cID.substring(1, 2));
        let c = parseInt(cID.substring(2, 3));

        // Add X/O to clicked cell
        // First time
        while (document.getElementById(cID).innerHTML == "") {

            if (countO == countX) {
                if (sltPlayer[0].checked) {
                    document.getElementById(cID).innerHTML = sltPlayer[0].value;
                    board[r][c] = sltPlayer[0].value;
                    document.getElementById('msg').innerHTML = "Next player: " + sltPlayer[1].value;
                    countX++;
                } else {
                    document.getElementById(cID).innerHTML = sltPlayer[1].value;
                    board[r][c] = sltPlayer[1].value;
                    document.getElementById('msg').innerHTML = "Next player: " + sltPlayer[0].value;
                    countO++;
                }
            }
            // Next time
            else if (countX > countO) {
                document.getElementById(cID).innerHTML = sltPlayer[1].value;
                board[r][c] = sltPlayer[1].value;
                document.getElementById('msg').innerHTML = "Next player: " + sltPlayer[0].value;
                countO++;
            } else if (countO > countX) {
                document.getElementById(cID).innerHTML = sltPlayer[0].value;
                board[r][c] = sltPlayer[0].value;
                document.getElementById('msg').innerHTML = "Next player: " + sltPlayer[1].value;
                countX++;
            }

        }
        //Who is winner?
        checkWin(r, c);
        //Game i draw?
        countTotal++;
        if (countTotal == (rowNum * colNum)) {
            alert('Game is DRAW!!!');
        }
    }

    // Check winner
    function checkWin(r, c) {
        let count = 0;
        let check = [];
        // Find by col
        for (let i = -winNum + 1; i < winNum; i++) {
            if ((r + i >= 0) && (r + i < colNum)) {
                if (board[r + i][c] == board[r][c]) {
                    check[count * 2] = r + i;
                    check[count * 2 + 1] = c;
                    count++;
                } else {
                    count = 0;
                    check = [];
                }
            } else {
                count = 0;
            }
            if (count == winNum) {
                alert('Winner: ' + board[r][c]);
                for (let k = 0; k < check.length; k = k + 2) {
                    let cell = document.getElementById('c' + check[k] + check[k + 1]);
                    cell.style.backgroundColor = 'blue';
                }
                break;
            }
        }
        // Find by row
        count = 0;
        check = [];
        for (let i = -winNum + 1; i < winNum; i++) {
            if ((c + i >= 0) && (c + i < colNum)) {
                if (board[r][c + i] == board[r][c]) {
                    check[count * 2] = r;
                    check[count * 2 + 1] = c + i;
                    count++;
                } else {
                    count = 0;
                    check = [];
                }
            } else {
                count = 0;
            }
            if (count == winNum) {
                alert('Winner: ' + board[r][c]);
                for (let k = 0; k < check.length; k = k + 2) {
                    let cell = document.getElementById('c' + check[k] + check[k + 1]);
                    cell.style.backgroundColor = 'blue';
                }
                break;
            }
        }
        // Find by cross 1
        count = 0;
        check = [];
        for (let i = -winNum + 1; i < winNum; i++) {
            if ((r + i >= 0) && (c + i >= 0) && (r + i < rowNum) && (c + i < colNum)) {
                if (board[r + i][c + i] == board[r][c]) {
                    check[count * 2] = r + i;
                    check[count * 2 + 1] = c + i;
                    count++;
                } else {
                    count = 0;
                    check = [];
                }
            } else {
                count = 0;
            }
            if (count == winNum) {
                alert('Winner: ' + board[r][c]);
                for (let k = 0; k < check.length; k = k + 2) {
                    let cell = document.getElementById('c' + check[k] + check[k + 1]);
                    cell.style.backgroundColor = 'blue';
                }
                break;
            }
        }
        // Find by cross 2
        count = 0;
        check = [];
        for (let i = -winNum + 1; i < winNum; i++) {
            if ((r - i >= 0) && (c + i >= 0) && (r - i < rowNum) && (c + i < colNum)) {
                if (board[r - i][c + i] == board[r][c]) {
                    check[count * 2] = r - i;
                    check[count * 2 + 1] = c + i;
                    count++;
                } else {
                    count = 0;
                    check = [];
                }
            } else {
                count = 0;
            }
            if (count == winNum) {
                alert('Winner: ' + board[r][c]);
                for (let k = 0; k < check.length; k = k + 2) {
                    let cell = document.getElementById('c' + check[k] + check[k + 1]);
                    cell.style.backgroundColor = 'blue';
                }
                break;
            }
        }
    }

</script>
</html>